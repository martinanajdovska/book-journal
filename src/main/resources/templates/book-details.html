<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
<div class="container">
    <div class="row">
        <a type="button" style="width: 150px;" class="btn btn-primary mt-5" href="/">Back</a>
    </div>
    <div class="row my-5 border p-4">
        <div class="col-6">
            <img style="max-height: 20rem;" th:src="@{'/uploads/'+${book.getFile()}}" alt="Image for book">
        </div>
        <div class="col-6">
            <h3 th:text="${book.getTitle()}"></h3>
            <h2 th:text="${book.getAuthor()}"></h2>
            <p th:text="'Pages: ' + ${book.getPages()}"></p>
            <p th:text="${book.getGenre().getDisplayValue()}"></p>
            <p th:text="'Average rating: ' + (${averageRating != null ? averageRating : 'No ratings yet.'})"></p>
<!--            TODO: make selection of: to-read, read, currently-reading-->
            <a class="btn btn-sm btn-info" th:text="${!toReadBook}?'To read':'Remove from to-read'"
               th:href="@{'/books/to-read/{id}?redirect=/books/details/{id}' (id=${book.getId()})}"></a>
            <a class="btn btn-sm btn-info" th:if="${!hasRead}" th:href="${'/books/read/'+book.getId()}">Mark as read</a>
            <a class="btn btn-sm btn-info" th:if="${hasRead}" th:href="${'/books/remove-read/'+book.getId()}">Remove
                from read</a>
<!--            TODO: make form for inputting starting date and reading progress-->
            <a class="btn btn-sm btn-info"
               th:href="@{'/books/currently-reading/{id}?redirect=/books/details/{id}' (id=${book.getId()})}">Currently reading</a>
            <th:block th:if="${hasRead && userReadBook != null}">
                <form method="post" th:action="'/books/read/'+${book.getId()}">
                    <div class="form-group">
                        <label for="startedDate">Started date:</label>
                        <input type="date"
                               style="width:150px;"
                               class="form-control"
                               id="startedDate"
                               name="startedDate"
                               th:value="(${userReadBook.getStartedDate()} != null ? ${userReadBook.getStartedDate()} : null)"
                               placeholder="startedDate">
                        <label for="finishedDate">Finished date:</label>
                        <input type="date"
                               style="width:150px;"
                               class="form-control"
                               id="finishedDate"
                               name="finishedDate"
                               th:value="(${userReadBook.getFinishedDate()} != null ? ${userReadBook.getFinishedDate()} : null)"
                               placeholder="finishedDate">
                    </div>
                    <input type="submit" class="btn btn-primary" value="Add dates">
                </form>
            </th:block>
            <p class="mt-3 mb-0">Summary:</p>
            <p th:text="${book.getDescription()}"></p>
        </div>
    </div>
    <div class="row border p-3">
        <th:block th:if="${hasRead}">
            <form method="post" th:action="'/books/review/'+${book.getId()}" class="col-6">
                <label for="review">Add review:</label>
                <textarea class="form-control" name="review" id="review" rows="3" placeholder="Enter review"></textarea>
                <div class="form-group mt-2" style="width: 80px;">
                    <label for="rating">Rating:</label>
                    <select name="rating" class="form-control" id="rating">
                        <option value="" selected></option>
                        <option th:each="ratingOpt : ${ratings}"
                                th:value="${ratingOpt}" th:text="${ratingOpt}"></option>
                    </select>
                </div>
                <input type="submit" class="btn btn-primary" value="Submit review">
            </form>
            <form method="post" th:action="'/books/quote/'+${book.getId()}" class="col-6">
                <label for="quote">Add quote:</label>
                <textarea class="form-control" name="quote" id="quote" rows="3" placeholder="Enter quote"></textarea>
                <input type="submit" class="btn btn-primary mt-3" value="Submit quote">
            </form>
        </th:block>
    </div>
    <h3 class="mt-5">My saved quotes:</h3>
    <div class="row mb-5">
        <th:block th:if="${quotes.size() > 0}">
            <div th:each="quote : ${quotes}" class="col-3 border p-2 m-1">
                <p th:text="${quote.getText()}"></p>
            </div>
        </th:block>
    </div>
    <h3 class="mt-5">Book reviews:</h3>
    <div class="row mb-5">
        <th:block th:if="${reviews.size() > 0}">
            <div th:each="review : ${reviews}" class="col-3 border p-2 m-1">
                <p class="mb-0" th:text="'User: ' + ${review.getUser().getUsername()}"></p>
                <hr>
                <p th:text="${review.getReview()}"></p>
                <hr>
                <p th:if="${review.getRating()!=null}" th:text="${review.getRating()}"></p>
            </div>
        </th:block>
    </div>
</div>
</body>
</html>